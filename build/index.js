(()=>{"use strict";var e,t={172:(e,t,o)=>{var r={};o.r(r),o.d(r,{isAuthenticated:()=>P});var a={};o.r(a),o.d(a,{updateAuthenticationStatus:()=>A});const i=window.wp.blocks,l=window.React,n=function(){return(0,l.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 771.444"},(0,l.createElement)("rect",{x:"427.842",width:"166.721",height:"172.249",fill:"#4FC3F7"}),(0,l.createElement)("rect",{x:"338.962",y:"172.249",width:"255.601",height:"166.721",fill:"#5586FF"}),(0,l.createElement)("rect",{x:"172.241",y:"172.249",width:"166.721",height:"255.609",fill:"#3D5AFE"}),(0,l.createElement)("rect",{y:"427.858",width:"338.962",height:"166.721",fill:"#3949AB"}),(0,l.createElement)("rect",{x:"851.743",y:"176.865",width:"172.257",height:"166.721",fill:"#FFAB00"}),(0,l.createElement)("rect",{x:"685.022",y:"176.865",width:"166.721",height:"255.609",fill:"#FF5252"}),(0,l.createElement)("rect",{x:"596.142",y:"432.474",width:"255.601",height:"166.721",fill:"#F50057"}),(0,l.createElement)("rect",{x:"429.421",y:"432.483",width:"166.721",height:"338.961",fill:"#C51162"}))},c=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woosmap/store-locator-widget-block","version":"0.1.0","title":"Woosmap Store Locator Widget Block","category":"widgets","keywords":["Woosmap","Store Locator","Store Finder","Map"],"description":"Easily display your stores on a Map using Woosmap platform","supports":{"align":["wide","full"],"spacing":{"margin":true},"html":false,"multiple":false},"attributes":{"height":{"type":"string","default":"500"},"apiKey":{"type":"string"},"theme":{"type":"object","properties":{"primary_color":{"type":"string","default":"#000"}},"default":{"primary_color":"#000"}},"internationalization":{"type":"object","default":{"lang":"en","unitSystem":0}},"woosmapView":{"type":"object","default":{"breakPoint":10,"tileStyle":{"color":"#000","size":11,"minSize":5},"initialCenter":{"lat":50,"lng":0},"initialZoom":6}},"maps":{"type":"object","default":{"provider":"woosmap","localities":{"types":["locality","postal_code","address","admin_level","country"]}}},"filters":{"type":"object"},"initialSearch":{"type":"object"},"datasource":{"type":"object"}},"textdomain":"store-locator-widget-block","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css","viewScript":"file:./view.js"}'),s=window.wp.components,u=window.wp.i18n,d=window.wp.blockEditor,m=window.wp.element,p=window.wp.data,g=window.wp.compose,w={primary_color:"#000"},b={max_responses:5,max_distance:5e4},h={lang:"en",unitSystem:0},y={provider:"woosmap",localities:{types:["locality","postal_code","address","admin_level","country"]}},k={initialCenter:{lat:50,lng:0},initialZoom:13,tileStyle:{color:"#000",size:11,minSize:5,typeRules:[]},breakPoint:10};function _(e,t){return Object.keys(t).forEach((o=>{Array.isArray(t[o])?e[o]=t[o]:t[o]&&"object"==typeof t[o]?(e[o]||(e[o]={}),_(e[o],t[o])):e[o]=t[o]})),e}function f(e,t={}){try{return _(t,JSON.parse(e))}catch(e){return(0,p.dispatch)("core/notices").createErrorNotice(`Error parsing conf: ${e.message}`,{isDismissible:!0,type:"snackbar"}),t}}function E(e,t=null){const o="https://webapp.woosmap.com/webapp.js";if(e.ownerDocument.querySelector(`script[src^="${o}"][data-loading]`))return;const r=e.ownerDocument.querySelectorAll(`script[src^="${o}"], script[src^="https://sdk.woosmap.com/map/map.js"]`);r.length&&(["WebApp","woosmap","__webapp_maps_callback"].forEach((t=>{void 0!==e.ownerDocument.defaultView[t]&&(e.ownerDocument.defaultView[t]=null)})),r.forEach((e=>e.parentNode.removeChild(e))));const a=e.ownerDocument.createElement("script");a.src=o,a.setAttribute("data-loading","true"),a.onload=()=>{a.removeAttribute("data-loading"),t&&"function"==typeof t&&t()},a.onerror=e=>{(0,p.dispatch)("core/notices").createErrorNotice(`Failed to load Woosmap WebApp script: ${e}`,{isDismissible:!0,type:"snackbar"}),a.removeAttribute("data-loading")},e.ownerDocument.head.appendChild(a)}class S{constructor(e){this.element=e,this.storeLocatorConfig={},this.element.dataset.apiKey&&E(this.element,(()=>{this.webAppLib=this.element.ownerDocument.defaultView.WebApp,this.init()}))}init(){this.createStoreLocatorWidget()}createStoreLocatorWidget(){const e=function(e){const{filters:t="{}",theme:o="{}",datasource:r="{}",internationalization:a="{}",woosmapView:i="{}",maps:l="{}",initialSearch:n="{}",apiKey:c}=e,s=f(i,k),u=f(o,w),d=f(r,b),m=f(a,h),p=f(t),g=f(n),_={theme:u,datasource:d,internationalization:m,maps:{...f(l,y),apiKey:c},woosmapView:{...s,initialCenter:s.initialCenter,initialZoom:s.initialZoom,tileStyle:{color:s.tileStyle.color,size:Number(s.tileStyle.size),minSize:Number(s.tileStyle.minSize),typeRules:s.tileStyle.typeRules},breakPoint:Number(s.breakPoint),style:{rules:s.style.rules,default:s.style.default}},filters:p,initialSearch:g};return function(e){Object.keys(e).forEach((t=>{var o;(null==(o=e[t])||"object"==typeof o&&0===Object.keys(o).length||"string"==typeof o&&""===o.trim())&&delete e[t]}))}(_),_}(this.element.dataset);this.storeLocatorConfig=function(e){if(!e.maps.apiKey||"string"!=typeof e.maps.apiKey||!e.maps.apiKey.trim())throw new Error("StoreLocator configuration error: apiKey is required and must be a non-empty string.");return e}(e),this.element.innerHTML="";const t=document.createElement("div");t.style="width:100%; height:100%",t.id="store-locator-widget-id",this.element.appendChild(t),this.storeLocatorWidget=new this.webAppLib(t.id,this.storeLocatorConfig.maps.apiKey),this.storeLocatorWidget.isMobile=!1,this.storeLocatorWidget.setConf(this.storeLocatorConfig),this.storeLocatorWidget.render()}}class v extends S{constructor(e,t,o){super(e),this.clientId=t,this.setAttributes=o,this.initEdit()}initEdit(){this.addListeners()}remove(){this.storeLocatorWidget&&(this.element.parentNode.removeChild(this.element),this.storeLocatorWidget=null)}addListeners(){this.element.addEventListener("click",(()=>{(0,p.dispatch)("core/block-editor").selectBlock(this.clientId)}))}updateDatasetProperty(e,t){this.element.dataset[e]="object"==typeof t?JSON.stringify(t):t}update(e,t=!0){Object.entries(e).forEach((([e,t])=>{"height"===e?this.element.style.height=`${t}px`:this.updateDatasetProperty(e,t)})),t&&E(this.element,(()=>{this.webAppLib=this.element.ownerDocument.defaultView.WebApp,this.init()}))}}const C=(0,p.combineReducers)({authenticationReducer:function(e,t){return"UPDATE_AUTHENTICATION"===t.type?{...e,authenticated:t.isAuthenticated}:e}});function P(e){return Boolean(e?.authenticationReducer?.authenticated)}function A(e){return{type:"UPDATE_AUTHENTICATION",isAuthenticated:e}}const R=(0,p.createReduxStore)("woosmap/store-locator-widget-block",{reducer:C,selectors:r,actions:a});function N(e){const{attributes:{height:t,theme:o,woosmapView:r},setAttributes:a}=e;return(0,l.createElement)(s.PanelBody,{title:(0,u.__)("Display Settings","store-locator-widget-block")},(0,l.createElement)(s.PanelRow,null,(0,l.createElement)("label",{htmlFor:"theme-color-control"},(0,u.__)("Primary Color","store-locator-widget-block")),(0,l.createElement)(s.ColorIndicator,{id:"theme-color-control",colorValue:o.primary_color})),(0,l.createElement)(s.ColorPalette,{value:o.primary_color,onChange:e=>a({theme:{primary_color:e}})}),(0,l.createElement)(s.RangeControl,{label:(0,u.__)("Zoom","store-locator-widget-block"),value:r.initialZoom,onChange:e=>a({woosmapView:{...r,initialZoom:e}}),min:0,max:20,step:.5}),(0,l.createElement)(s.RangeControl,{label:(0,u.__)("Height ( pixels )","store-locator-widget-block"),value:Number(t),onChange:e=>a({height:e}),min:250,max:3e3,step:5}),(0,l.createElement)(s.RangeControl,{label:(0,u.__)("Default Latitude","store-locator-widget-block"),value:r.initialCenter.lat,onChange:e=>a({woosmapView:{...r,initialCenter:{...r.initialCenter,lat:e}}}),min:-90,max:90,step:.1}),(0,l.createElement)(s.RangeControl,{label:(0,u.__)("Default Longitude","store-locator-widget-block"),value:r.initialCenter.lng,onChange:e=>a({woosmapView:{...r,initialCenter:{...r.initialCenter,lng:e}}}),min:-180,max:180,step:.1}))}function x(e){const{marker:t,update:o}=e,[r,a]=(0,m.useState)(t.markerUrl),i=["image"];(0,m.useEffect)((()=>{t.markerUrl&&a(t.markerUrl)}),[t.markerUrl]);const n=e=>{a(e.url),o({...t,markerUrl:e.url})};return(0,l.createElement)("div",{className:"store-locator-widget-block-marker-uploader"},(0,l.createElement)(s.BaseControl,{id:"marker-icon-control",label:(0,u.__)("Marker Icon","store-locator-widget-block")},(0,l.createElement)(d.MediaUploadCheck,null,(0,l.createElement)(d.MediaUpload,{allowedTypes:i,render:({open:e})=>(0,l.createElement)(s.Button,{className:r?"editor-post-featured-image__preview":"editor-post-featured-image__toggle",onClick:e},!r&&(0,u.__)("Choose an icon","store-locator-widget-block"),r&&(0,l.createElement)("img",{src:r,alt:(0,u.__)("Marker icon","store-locator-widget-block")})),onSelect:n,value:r})),!!r&&(0,l.createElement)(d.MediaUploadCheck,null,r&&(0,l.createElement)(d.MediaUpload,{onSelect:n,allowedTypes:i,render:({open:e})=>(0,l.createElement)(s.Button,{onClick:e,variant:"secondary",className:"replace-marker-icon"},(0,u.__)("Replace icon","store-locator-widget-block"))}),(0,l.createElement)(s.Button,{className:"remove-marker-icon",onClick:()=>{a(void 0),o({...t,markerUrl:void 0})},variant:"link",isDestructive:!0},(0,u.__)("Remove icon","store-locator-widget-block")))))}(0,p.register)(R);const I=({label:e,markerUrl:t,update:o})=>(0,l.createElement)(s.PanelBody,{title:e,className:"marker-edit",icon:(0,l.createElement)("img",{src:t,alt:"Marker Icon",style:{height:"20px"}}),initialOpen:!1},(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(x,{marker:{markerUrl:t},update:o})));function L({attributes:{woosmapView:e},setAttributes:t}){const{breakPoint:o,tileStyle:r,style:a}=e||{},i=(o,r)=>{t({woosmapView:{...e,[o]:r}})},n=(e,t,o)=>(0,l.createElement)(I,{label:e,markerUrl:t,update:e=>{return t={[o]:{url:e.markerUrl}},void i("style",{...a,default:{...a.default,...t}});var t}});return(0,l.createElement)(s.PanelBody,{title:(0,u.__)("Marker Settings","store-locator-widget-block"),initialOpen:!1},(0,l.createElement)(s.PanelRow,null,(0,l.createElement)("label",{htmlFor:"tile-color-control"},(0,u.__)("Tile Color","store-locator-widget-block")),(0,l.createElement)(s.ColorIndicator,{id:"tile-color-control",colorValue:r.color})),(0,l.createElement)(s.ColorPalette,{value:r.color,onChange:e=>i("tileStyle",{...r,color:e})}),(0,l.createElement)(s.RangeControl,{label:(0,u.__)("Tile Size","store-locator-widget-block"),value:r.size,onChange:e=>i("tileStyle",{...r,size:e}),min:1,max:50,step:1}),(0,l.createElement)(s.RangeControl,{label:(0,u.__)("Break Point","store-locator-widget-block"),value:o,onChange:e=>i("breakPoint",e),min:1,max:20,step:1}),n((0,u.__)("Default Marker Url","store-locator-widget-block"),a.default.icon.url||window.woosmapPluginData.markerDefaultUrl,"icon"),n((0,u.__)("Selected Marker Url","store-locator-widget-block"),a.default.selectedIcon.url||window.woosmapPluginData.selectedDefaultUrl,"selectedIcon"),n((0,u.__)("Numbered Marker Url","store-locator-widget-block"),a.default.numberedIcon.url||window.woosmapPluginData.markerDefaultUrl,"numberedIcon"))}function z(e){const{marker:t,storeType:o,customDefaultMarkerUrl:r,customSelectedMarkerUrl:a,customNumberedMarkerUrl:i,updateMarker:n,updateTypeRules:c,deleteMarker:d}=e,[p,g]=(0,m.useState)(e.color),w=(e,o,r)=>(0,l.createElement)(s.PanelBody,{title:e,className:"marker-edit",icon:(0,l.createElement)("img",{src:o,alt:`${e} Icon`,style:{height:"20px"}}),initialOpen:!1},(0,l.createElement)(s.PanelRow,null,(0,l.createElement)(x,{marker:{markerUrl:o},update:e=>n({...t,[r]:{url:e.markerUrl}})})));return(0,l.createElement)(s.PanelBody,{title:(0,u.__)("Edit: ","store-locator-widget-block")+o,initialOpen:!1,icon:(0,l.createElement)(s.ColorIndicator,{id:"tile-color-control",colorValue:p})},(0,l.createElement)("p",null,(0,u.__)("Store Type: ","store-locator-widget-block"),(0,l.createElement)("code",null,o)),(0,l.createElement)("label",{htmlFor:"tile-color-control"},(0,u.__)("Tile Color","store-locator-widget-block")),(0,l.createElement)(s.ColorPalette,{value:p,onChange:e=>{g(e),c(e)}}),w((0,u.__)("Default Marker Icon","store-locator-widget-block"),r,"icon"),w((0,u.__)("Selected Marker Icon","store-locator-widget-block"),a,"selectedIcon"),w((0,u.__)("Numbered Marker Icon","store-locator-widget-block"),i,"numberedIcon"),(0,l.createElement)(s.Button,{variant:"primary",onClick:d},(0,u.__)("Delete Custom Marker","store-locator-widget-block")))}function D({attributes:{woosmapView:e},setAttributes:t}){const[o,r]=(0,m.useState)("");return(0,l.createElement)(s.PanelBody,{title:(0,u.__)("Custom Marker Settings","store-locator-widget-block"),initialOpen:!1},(0,l.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(s.TextControl,{label:(0,u.__)("Store Type","store-locator-widget-block"),value:o,onChange:r}),(0,l.createElement)(s.Button,{variant:"primary",onClick:()=>{if(!o.trim())return void(0,p.dispatch)("core/notices").createErrorNotice((0,u.__)("Store Type Title cannot be empty","store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});const{icon:a,selectedIcon:i,numberedIcon:l}=e.style?.default||{};if(!a?.url||!i?.url||!l?.url)return void(0,p.dispatch)("core/notices").createErrorNotice((0,u.__)("Marker URLs are missing in woosmapView.style.default","store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});const n={type:o,icon:{url:a.url},selectedIcon:{url:i.url},numberedIcon:{url:l.url}},c=[...e.style?.rules||[],n],s={type:o,color:e.tileStyle?.color||"#000000"},d=[...e.tileStyle?.typeRules||[],s];t({woosmapView:{...e,style:{...e.style,rules:c},tileStyle:{...e.tileStyle,typeRules:d}}}),r("")}},(0,u.__)("Add Custom Marker","store-locator-widget-block"))),(e.style?.rules||[]).map(((o,r)=>(0,l.createElement)(z,{key:r,marker:o,storeType:o.type,customDefaultMarkerUrl:o.icon.url,customSelectedMarkerUrl:o.selectedIcon.url,customNumberedMarkerUrl:o.numberedIcon.url,color:e.tileStyle?.typeRules?.find((e=>e.type===o.type))?.color||e.tileStyle?.color,updateMarker:o=>((o,r)=>{const a=e.style.rules.map(((e,t)=>t===o?r:e));t({woosmapView:{...e,style:{...e.style,rules:a}}})})(r,o),updateTypeRules:r=>((o,r)=>{const a=e.tileStyle.typeRules.map((t=>t.type===o?{...t,color:r||e.tileStyle?.color}:t));t({woosmapView:{...e,tileStyle:{...e.tileStyle,typeRules:a}}})})(o.type,r),deleteMarker:()=>(o=>{const r=e.style.rules.filter(((e,t)=>t!==o));t({woosmapView:{...e,style:{...e.style,rules:r}}})})(r)}))))}function O(e){const{attributes:{internationalization:t},setAttributes:o}=e;return(0,l.createElement)(s.PanelBody,{title:(0,u.__)("Internationalization Settings","store-locator-widget-block"),initialOpen:!1},(0,l.createElement)(s.SelectControl,{label:(0,u.__)("Language","store-locator-widget-block"),value:t.lang,onChange:e=>o({internationalization:{...t,lang:e}})},(0,l.createElement)("option",{value:"pt-br"},(0,u.__)("Brazilian Portuguese","store-locator-widget-block")),(0,l.createElement)("option",{value:"ca"},(0,u.__)("Catalan","store-locator-widget-block")),(0,l.createElement)("option",{value:"zh"},(0,u.__)("Chinese","store-locator-widget-block")),(0,l.createElement)("option",{value:"zh-HK"},(0,u.__)("Chinese (Hong Kong)","store-locator-widget-block")),(0,l.createElement)("option",{value:"hr"},(0,u.__)("Croatian","store-locator-widget-block")),(0,l.createElement)("option",{value:"de"},(0,u.__)("Deutsch","store-locator-widget-block")),(0,l.createElement)("option",{value:"nl"},(0,u.__)("Dutch","store-locator-widget-block")),(0,l.createElement)("option",{value:"en"},(0,u.__)("English","store-locator-widget-block")),(0,l.createElement)("option",{value:"fr"},(0,u.__)("French","store-locator-widget-block")),(0,l.createElement)("option",{value:"el"},(0,u.__)("Greek","store-locator-widget-block")),(0,l.createElement)("option",{value:"he"},(0,u.__)("Hebrew","store-locator-widget-block")),(0,l.createElement)("option",{value:"it"},(0,u.__)("Italian","store-locator-widget-block")),(0,l.createElement)("option",{value:"ja"},(0,u.__)("Japanese","store-locator-widget-block")),(0,l.createElement)("option",{value:"pl"},(0,u.__)("Polish","store-locator-widget-block")),(0,l.createElement)("option",{value:"pt"},(0,u.__)("Portuguese","store-locator-widget-block")),(0,l.createElement)("option",{value:"ro"},(0,u.__)("Romanian","store-locator-widget-block")),(0,l.createElement)("option",{value:"ru"},(0,u.__)("Russian","store-locator-widget-block")),(0,l.createElement)("option",{value:"es"},(0,u.__)("Spanish","store-locator-widget-block")),(0,l.createElement)("option",{value:"sv"},(0,u.__)("Swedish","store-locator-widget-block")),(0,l.createElement)("option",{value:"uk"},(0,u.__)("Ukrainian","store-locator-widget-block"))),(0,l.createElement)(s.SelectControl,{label:(0,u.__)("Period","store-locator-widget-block"),value:t.period,onChange:e=>o({internationalization:{...t,period:e}})},(0,l.createElement)("option",{value:"fr"},(0,u.__)("24h","store-locator-widget-block")),(0,l.createElement)("option",{value:"en-US"},(0,u.__)("12h","store-locator-widget-block"))),(0,l.createElement)(s.SelectControl,{label:(0,u.__)("Unit System","store-locator-widget-block"),value:t.unitSystem,onChange:e=>o({internationalization:{...t,unitSystem:Number(e)}})},(0,l.createElement)("option",{value:"0"},(0,u.__)("Metric","store-locator-widget-block")),(0,l.createElement)("option",{value:"1"},(0,u.__)("Imperial","store-locator-widget-block"))))}function B(e){const{isAuthenticated:t}=e;return t?(0,l.createElement)(d.InspectorControls,null,(0,l.createElement)(N,{...e}),(0,l.createElement)(O,{...e}),(0,l.createElement)(L,{...e}),(0,l.createElement)(D,{...e})):(0,l.createElement)(d.InspectorControls,null,(0,l.createElement)(s.PanelBody,null,(0,l.createElement)("p",null,(0,u.__)("You need to confirm your access to Woosmap before you can continue.","store-locator-widget-block"))))}function T({setApiKey:e}){const[t,o]=(0,m.useState)(""),[r,a]=(0,m.useState)(!1),i=(0,p.useSelect)((e=>e("core").getEntityRecord("root","site")),[]);return(0,m.useEffect)((()=>{if(i){const{woosmap_settings:{woosmap_public_api_key:e}}=i;o(e)}}),[i]),(0,l.createElement)(l.Fragment,null,(0,l.createElement)(s.TextControl,{label:(0,u.__)("Please enter your Public API Key","store-locator-widget-block"),readOnly:r,name:"woosmap_public_api_key",value:t||"",onChange:e=>o(e)}),(0,l.createElement)(s.Button,{isPrimary:!0,disabled:r,isBusy:r,onClick:()=>{a(!0),(0,p.dispatch)("core").saveEntityRecord("root","site",{woosmap_settings:{woosmap_public_api_key:t}}).then((({woosmap_settings:{woosmap_public_api_key:t}})=>{o(t),a(!1),e(t),window.dispatchEvent(new CustomEvent("woosmapSettingsSaved"))})).catch((e=>{(0,p.dispatch)("core/notices").createErrorNotice(e.message,{isDismissible:!0,type:"snackbar"}),a(!1)}))}},(0,u.__)("Confirm Woosmap Credentials","store-locator-widget-block")))}const U={top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};function W({onResizeStart:e,onResize:t,onResizeStop:o,...r}){const[a,i]=(0,m.useState)(!1);return(0,l.createElement)(s.ResizableBox,{style:{position:"absolute",top:0,left:0,right:0,bottom:0},className:"store-locator-widget-block__resize-container "+(a?"is-resizing":""),enable:U,onResizeStart:(o,r,a)=>{e(a.clientHeight),t(a.clientHeight)},onResize:(e,o,r)=>{t(r.clientHeight),a||i(!0)},onResizeStop:(e,t,r)=>{o(r.clientHeight),i(!1)},minHeight:250,...r})}function M({blockProps:e,initialConfig:t,onValidateConfig:o}){const[r,a]=(0,m.useState)(JSON.stringify(t,null,2)),i=(0,m.useCallback)((()=>{try{const e=function(e){const t=e.replace(/([,{]\s*)([a-zA-Z0-9_]+):/g,'$1"$2":').replace(/\b(true|false|null)\b/g,(e=>e.toLowerCase())).replace(/,\s*([}\]])/g,"$1").trim();try{const e=JSON.parse(t);return e.hasOwnProperty("woosmapview")&&(e.woosmapView=e.woosmapview,delete e.woosmapview),JSON.stringify(e,null,2)}catch(e){throw new Error("Failed to process input config into valid JSON: "+e.message)}}(r);a(e);const t=JSON.parse(e);o(t)}catch(e){const t=`Invalid Widget Conf format: ${e.message}`;(0,p.dispatch)("core/notices").createErrorNotice(t,{isDismissible:!0,type:"snackbar"})}}),[r,o]),n=(0,m.useCallback)((()=>{window.navigator.clipboard.writeText(r).then((()=>{(0,p.dispatch)("core/notices").createSuccessNotice((0,u.__)("Configuration copied to clipboard.","store-locator-widget-block"),{isDismissible:!0,type:"snackbar"})})).catch((()=>{(0,p.dispatch)("core/notices").createErrorNotice((0,u.__)("Failed to copy configuration","store-locator-widget-block"),{isDismissible:!0,type:"snackbar"})}))}),[r]);return(0,l.createElement)("div",{...e},(0,l.createElement)(s.Placeholder,{label:(0,u.__)("Store Locator Widget Configuration","store-locator-widget-block")},(0,l.createElement)("div",{style:{marginBottom:"1em"}},(0,u.__)("Before updating the configuration, please ensure that your JSON is valid and that it includes all necessary fields for the widget to function correctly.","store-locator-widget-block")),(0,l.createElement)(s.Button,{isPrimary:!0,onClick:i,style:{marginTop:"10px"}},(0,u.__)("Validate Configuration","store-locator-widget-block")),(0,l.createElement)(s.Button,{isSecondary:!0,onClick:n,style:{marginTop:"10px",marginLeft:"10px"}},(0,u.__)("Copy Configuration","store-locator-widget-block")),(0,l.createElement)(d.RichText,{value:r,tagName:"pre",onChange:e=>a(e),placeholder:(0,u.__)("Write json conf…"),"aria-label":(0,u.__)("Conf"),preserveWhiteSpace:!0,allowedFormats:[],withoutInteractiveFormatting:!0,__unstablePastePlainText:!0})))}const V=(0,m.memo)((e=>{const{storeLocatorWidget:t,isAuthenticated:o,clientId:r,setAttributes:a,setStoreLocatorWidget:i,apiKey:n}=e,c=!!t,s=(0,g.useRefEffect)((e=>(o&&!c&&i(new v(e,r,a)),()=>{c&&(t.remove(),i(null))})),[n,o,t,r,a]);return(0,l.createElement)("div",{id:"storeLocatorWidgetEdit",ref:s})}));(0,i.registerBlockType)(c,{attributes:{...c.attributes},icon:n,edit:function(e){const{attributes:t,setAttributes:o,clientId:r,isSelected:a}=e,{height:i,apiKey:c}=t,[w,b]=(0,m.useState)(null),[h,y]=(0,m.useState)(c),k=!!w,[_,f]=(0,m.useState)(!0),[E,S]=(0,m.useState)(!0),v=(0,p.useSelect)((e=>e(R).isAuthenticated())),{updateAuthenticationStatus:C}=(0,p.useDispatch)(R),{toggleSelection:P}=(0,p.useDispatch)(d.store),A=(0,g.useDebounce)((e=>{w.update(e)}),500),N=(0,g.useRefEffect)((()=>{const e=()=>{(({status:e})=>{"Initialized"===e&&C(!0)})({status:"Initialized"})};return f(!1),h&&!v&&e(),window.addEventListener("woosmapSettingsSaved",e),()=>{window.removeEventListener("woosmapSettingsSaved",e)}}));(0,m.useEffect)((()=>{v&&f(!1)}),[v]),(0,m.useEffect)((()=>{v&&k&&A(t)}),[t,v,w,k]),(0,m.useEffect)((()=>{if(!t.woosmapView.style){const{markerDefaultUrl:e,markerSelectedUrl:r}=window.woosmapPluginData;o({...t,woosmapView:{...t.woosmapView,style:{default:{icon:{url:e},selectedIcon:{url:r},numberedIcon:{url:e}}}}})}}),[o,t]);const x=(0,d.useBlockProps)({ref:N});return _?(0,l.createElement)("div",{...x},(0,l.createElement)(s.Placeholder,{style:{height:`${i}px`},label:(0,u.__)("Block for Woosmap Store Locator Widget","store-locator-widget-block"),icon:n},(0,l.createElement)(s.Spinner,null))):v?E?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(d.BlockControls,null,(0,l.createElement)(s.ToolbarGroup,null,(0,l.createElement)(s.ToolbarButton,{icon:"location",label:(0,u.__)("Show Map","store-locator-widget-block"),onClick:()=>S(!1)}))),(0,l.createElement)(M,{blockProps:x,initialConfig:{woosmapView:t.woosmapView,theme:t.theme,initialSearch:t.initialSearch,internationalization:t.internationalization,filters:t.filters,maps:t.maps,datasource:t.datasource},onValidateConfig:e=>{o({...t,...e}),S(!1)}})):(0,l.createElement)(l.Fragment,null,(0,l.createElement)(d.BlockControls,null,(0,l.createElement)(s.ToolbarGroup,null,(0,l.createElement)(s.ToolbarButton,{icon:"admin-generic",label:(0,u.__)("Show Configuration","store-locator-widget-block"),onClick:()=>S(!0)}))),(0,l.createElement)(B,{...e,isAuthenticated:v,storeLocatorWidget:w}),(0,l.createElement)("div",{...x},(0,l.createElement)(W,{onResizeStart:()=>{P(!1)},onResize:e=>{w.update({height:e.toString()},!1)},onResizeStop:e=>{o({height:e.toString()}),P(!0)},showHandle:a,size:{height:i}}),(0,l.createElement)(V,{clientId:r,setAttributes:o,isAuthenticated:v,storeLocatorWidget:w,setStoreLocatorWidget:b,apiKey:h}))):(0,l.createElement)(l.Fragment,null,(0,l.createElement)(B,{...e,isAuthenticated:v,storeLocatorWidget:w}),(0,l.createElement)("div",{...x},(0,l.createElement)(s.Placeholder,{style:{minHeight:`${i}px`},label:(0,u.__)("Authorize Woosmap Access","store-locator-widget-block"),icon:n,isColumnLayout:!0},(0,l.createElement)("div",{style:{marginBottom:"1em"}},(0,u.__)("To embed a Woosmap Store Locator Widget in your website, you need to provide your Public API Key. Follow the instructions in the documentation to obtain this key: ","store-locator-widget-block"),(0,l.createElement)("a",{href:"https://developers.woosmap.com/support/api-keys/#registering-a-woosmap-public-api-key",target:"_blank",rel:"noopener noreferrer"},(0,u.__)("Guide to register a Woosmap Public API Key.","store-locator-widget-block"))),(0,l.createElement)(T,{setApiKey:e=>{y(e),o({apiKey:e})}}))))},save:function(e){const{attributes:{height:t,apiKey:o,theme:r,internationalization:a,woosmapView:i,filters:n,maps:c,initialSearch:s,datasource:u}}=e,m=d.useBlockProps.save({style:{height:`${t}px`},id:"storeLocatorWidget"});return(0,l.createElement)("div",{...m,"data-height":t,"data-api-key":o,"data-theme":JSON.stringify(r),"data-internationalization":JSON.stringify(a),"data-woosmap-view":JSON.stringify(i),"data-filters":JSON.stringify(n),"data-maps":JSON.stringify(c),"data-initial-search":JSON.stringify(s),"data-datasource":JSON.stringify(u)})}})}},o={};function r(e){var a=o[e];if(void 0!==a)return a.exports;var i=o[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.m=t,e=[],r.O=(t,o,a,i)=>{if(!o){var l=1/0;for(u=0;u<e.length;u++){for(var[o,a,i]=e[u],n=!0,c=0;c<o.length;c++)(!1&i||l>=i)&&Object.keys(r.O).every((e=>r.O[e](o[c])))?o.splice(c--,1):(n=!1,i<l&&(l=i));if(n){e.splice(u--,1);var s=a();void 0!==s&&(t=s)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[o,a,i]},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={57:0,350:0};r.O.j=t=>0===e[t];var t=(t,o)=>{var a,i,[l,n,c]=o,s=0;if(l.some((t=>0!==e[t]))){for(a in n)r.o(n,a)&&(r.m[a]=n[a]);if(c)var u=c(r)}for(t&&t(o);s<l.length;s++)i=l[s],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(u)},o=globalThis.webpackChunkstore_locator_widget_block=globalThis.webpackChunkstore_locator_widget_block||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var a=r.O(void 0,[350],(()=>r(172)));a=r.O(a)})();